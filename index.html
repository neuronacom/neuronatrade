<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>NEURONA | Trade AI Bot</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body { background: #fff; margin:0; font-family:Arial,sans-serif; }
    .header {
      display:flex; align-items:center; gap:18px; padding:21px 18px 0 22px; min-height:68px;
    }
    .logo { width:40px; height:40px; }
    .title-wrap { display:flex; flex-direction:column; }
    .title { font-weight:bold; font-size:2rem; letter-spacing:.09em; }
    .subtitle { font-size:.99rem; color:#555; margin-top:-2px; }
    .refresh-btn {
      margin-left:auto; background:none; border:none; cursor:pointer;
      border-radius:50%; width:44px; height:44px; display:flex; align-items:center; justify-content:center;
      transition:background .15s; font-size:2rem;
    }
    .refresh-btn:active { background:#f4f6fa; }
    .refresh-btn svg { width:32px; height:32px; stroke:#222; }
    .main-block {
      display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
      min-height:calc(100vh - 88px);
      padding-top:10px;
    }
    .dialogue {
      margin-top:60px;
      min-width:310px; max-width:440px; width:100%;
      min-height:190px;
      border-radius:16px;
      box-shadow:0 7px 36px #d3d9e8a6, 0 2.5px 10px #abb6dd14;
      background:#fff;
      padding:24px 24px 18px 24px;
      position:relative;
      font-size:1.11rem;
      display:flex; flex-direction:column; gap:18px;
    }
    .signal-block {
      padding:14px 14px 8px 14px;
      border-radius:12px;
      font-size:1.12em;
      font-weight:500;
      margin-bottom:8px;
      box-shadow:0 1.5px 8px #e2ffea66;
      background:#f0fff3;
      color:#111;
      border:2px solid #b6efc1;
    }
    .signal-block.red { background:#fff0f0; color:#c11; border:2px solid #efb6b6; }
    .signal-block.green { background:#f0fff3; color:#151; border:2px solid #b6efc1; }
    .news-list { font-size:.98em; margin:7px 0 0 0; }
    .news-list li { margin-bottom:7px; }
    .ai-comment {
      margin-top:3px; font-size:1.01em; color:#2a3588; background:#f4f8ff; border-radius:7px; padding:6px 10px 7px;
    }
    .typing {display:inline-flex;gap:3px;vertical-align:middle;}
    .dot {width:8px;height:8px;background:#bbb;border-radius:50%;animation:dotty 1s infinite;}
    .dot2{animation-delay:.2s}.dot3{animation-delay:.38s}
    @keyframes dotty {0%,100%{opacity:.6;transform:translateY(0);} 45%{opacity:1;transform:translateY(-7px);}}
    @media(max-width:450px){
      .dialogue{min-width:99vw;max-width:100vw;}
      .main-block{padding:0}
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="https://i.ibb.co/Mk4WpHL9/25-1.png" class="logo" alt="N">
    <div class="title-wrap">
      <div class="title">NEURONA</div>
      <div class="subtitle">Trade AI Bot</div>
    </div>
    <button class="refresh-btn" onclick="showAll()" title="Обновить">
      <svg viewBox="0 0 24 24" fill="none" stroke-width="2.2"><path d="M4.5 10a7.5 7.5 0 1 1 1.6 7.6" stroke="currentColor"/><path d="M4 4v6h6" stroke="currentColor"/></svg>
    </button>
  </div>
  <div class="main-block">
    <div class="dialogue" id="dialogue">
      <div class="typing" id="typing" style="display:none">
        <span class="dot"></span><span class="dot dot2"></span><span class="dot dot3"></span>
      </div>
    </div>
  </div>
  <script>
    async function showAll() {
      const box = document.getElementById("dialogue");
      box.innerHTML = '<div class="typing" style="margin-top:22px"><span class="dot"></span><span class="dot dot2"></span><span class="dot dot3"></span></div>';
      try {
        const r = await fetch("https://tradeneurona-7da73bd0c5bb.herokuapp.com/api/feed");
        const js = await r.json();
        let signal = js.signal;
        let comment = js.ai_comment;
        let news = js.news;
        let color = signal.color;

        box.innerHTML =
          `<div class="signal-block ${color}">
            <b>BTC/USDT <span style="color:${color==='red'?'#d00':'#1b5'}">${signal.type}</span></b> — <span>Вход: <b>${signal.entry}</b>, TP: <b>${signal.tp}</b>, SL: <b>${signal.sl}</b><br>
            <span style="font-size:.96em">BID: ${signal.buy_vol} | ASK: ${signal.sell_vol} | 24ч: ${signal.change}%</span></span>
          </div>` +
          (comment ? `<div class="ai-comment">${comment}</div>` : "") +
          (news && news.length
            ? `<div class="news-list"><b>Новости CryptoPanic:</b><ul>${
                news.slice(0,2).map(n=>`<li><a href="${n.url}" target="_blank">${n.title}</a></li>`).join("")
              }</ul></div>`
            : ""
          );
      } catch (e) {
        box.innerHTML = '<div style="color:#5566bb;font-size:1.07em; background:#f4f6ff; border-radius:9px; padding:11px; margin:8px 0">Ошибка загрузки данных с сервера.</div>';
      }
    }
    showAll();
    setInterval(showAll, 90000); // автообновление раз в 90 сек
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
    // PUSH-уведомления при первом входе
    if ('Notification' in window && Notification.permission !== "granted") {
      setTimeout(()=>Notification.requestPermission(),700);
    }
  </script>
</body>
</html>
