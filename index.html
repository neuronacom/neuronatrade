<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <title>NEURONA TRADE AI</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#fff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="NEURONA TRADE">
  <link rel="apple-touch-icon" href="https://i.ibb.co/XfKRzvcy/27.png">
  <link rel="icon" type="image/png" href="https://i.ibb.co/XfKRzvcy/27.png">
  <link rel="preload" as="image" href="https://i.ibb.co/Mk4WpHL9/25-1.png">
  <style>
    * { box-sizing:border-box; margin:0; padding:0;}
    html, body {
      width:100vw; height:100vh; min-height:100vh; min-width:100vw;
      background:#fff; color:#000;
      -webkit-font-smoothing:antialiased;
      -webkit-text-size-adjust:none;
      overflow:hidden;
    }
    body {
      width:100vw; height:100vh;
      display:flex; flex-direction:column;
      align-items:center; justify-content:flex-start;
      background-color:#fff !important; color:#000 !important;
      transition:background 0.22s cubic-bezier(.38,.85,.48,1.01),color 0.22s;
      position:relative;
      overflow:hidden;
    }
    #bg {
      position:fixed; top:0; left:0; width:100vw; height:100vh;
      z-index:0; opacity:0.28;
      transition:opacity 1.4s cubic-bezier(.38,.85,.48,1.01);
      pointer-events:none;
    }
    #main-block {
      display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
      width:100%; max-width:410px; min-width:220px; margin:0 auto;
      margin-top:80px;
      z-index:1;
    }
    .card-block {
      background:rgba(255,255,255,0.97);
      border-radius:16px;
      box-shadow:0 6px 24px 0 rgba(30,40,80,0.14), 0 2.5px 10px 0 rgba(50,50,90,0.09);
      display:flex; flex-direction:column; overflow:hidden;
      width:100%; min-width:0;
      margin-bottom:20px;
      min-height:80px;
    }
    .signals-block {
      max-height:260px;
      min-height:140px;
    }
    .news-block {
      max-height:170px;
      min-height:80px;
    }
    .header {
      background:none;
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 22px 6px 22px;
      font-size:1.12rem;font-weight:700;color:#2051ba;letter-spacing:.07em;
    }
    .header.news {color:#777;}
    .content, .news-content {
      flex:1; overflow-y:auto;
      padding:7px 19px 14px 24px;
      font-size:1.08em;line-height:1.58;color:#20232d;
      scrollbar-width:thin;scrollbar-color:#b2b9c5 #ededed;
      background:transparent;
      word-break:break-word;
      font-family:Arial,'Segoe UI',sans-serif;
    }
    .content::-webkit-scrollbar, .news-content::-webkit-scrollbar{width:7px;background:#ededed;border-radius:9px;}
    .content::-webkit-scrollbar-thumb, .news-content::-webkit-scrollbar-thumb{background:#b2b9c5;border-radius:8px;}
    .signal-row {
      margin-bottom:14px; background:#eef3fb;border-radius:12px;padding:13px 13px 11px 13px;
      box-shadow:0 2px 8px #2451b726;
      border-left:4px solid #2051ba;
      display:flex; flex-direction:column; gap:8px;
    }
    .signal-title{font-weight:bold;color:#2051ba;font-size:1.13em;letter-spacing:.01em;}
    .signal-meta{display:flex;gap:12px;margin:2px 0 0 0;}
    .signal-param-list{margin:0 0 0 7px;padding-left:13px;}
    .signal-param-list li{margin-bottom:2px;}
    .signal-reason{margin:0 0 0 7px;color:#444;padding-top:2px;}
    .signal-time{display:block;color:#888;font-size:0.97em;margin-top:4px;margin-left:4px;}
    .news-list{list-style:none;padding:0;margin:0;}
    .news-item{margin-bottom:13px;}
    .news-link{color:#2051ba;text-decoration:none;font-weight:500;word-break:break-word;}
    .news-meta{display:block;color:#888;font-size:0.92em;margin-top:2px;}
    @media(max-width:520px){
      #main-block{max-width:98vw;}
      .card-block{max-width:98vw;}
      .header{font-size:1.01rem;}
    }
    @media(max-width:400px){
      #main-block{margin-top:55px;}
    }
    body.dark{background:#17181a !important;color:#ececec !important;}
    body.dark .card-block{background:#20232d;color:#fff;}
    body.dark .header{color:#99b5ff;}
    body.dark .header.news{color:#b2b9c5;}
    body.dark .signal-row{background:#23293c;border-left-color:#5167cb;}
    body.dark .signal-title{color:#b8c9ff;}
    body.dark .signal-reason{color:#bbb;}
    body.dark .news-link{color:#b8c9ff;}
    body.dark .news-meta{color:#b2b9c5;}
    body.dark .news-impact{color:#f1b45a;}
  </style>
</head>
<body>
<canvas id="bg"></canvas>
<div id="main-block">
  <div class="card-block signals-block">
    <div class="header">AI сигналы</div>
    <div class="content" id="signalsArea"></div>
  </div>
  <div class="card-block news-block">
    <div class="header news">Новости крипторынка</div>
    <div class="news-content" id="newsArea"></div>
  </div>
</div>
<script>
// --- Фон: нейронная сеть ---
const canvas = document.getElementById('bg'), ctx = canvas.getContext('2d');
let W,H,nodes;
function resize(){ W=canvas.width=innerWidth; H=canvas.height=innerHeight; }
window.addEventListener('resize',resize);
function init(){
  nodes=Array.from({length:33}).map(_=>({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*0.6,vy:(Math.random()-.5)*0.6}));
}
function draw(){
  ctx.clearRect(0,0,W,H);ctx.lineCap='round';ctx.lineJoin='round';
  nodes.forEach((a,i)=>{nodes.slice(i+1).forEach(b=>{
    const dx=a.x-b.x,dy=a.y-b.y,d=Math.hypot(dx,dy);
    if(d<240){
      ctx.strokeStyle=`rgba(60,84,154,${Math.min(0.23,(240-d)/155)})`;
      ctx.lineWidth=1.45;
      ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.stroke();
    }
  });});
  nodes.forEach(n=>{
    n.x+=n.vx;n.y+=n.vy;
    if(n.x<0||n.x>W)n.vx*=-1;
    if(n.y<0||n.y>H)n.vy*=-1;
    ctx.fillStyle='rgba(33,41,79,0.82)';
    ctx.beginPath();ctx.arc(n.x,n.y,4.2,0,2*Math.PI);ctx.fill();
  });
  requestAnimationFrame(draw);
}
resize();init();draw();

// --- Загрузка AI-сигналов и новостей ---
const signalsArea = document.getElementById('signalsArea');
const newsArea = document.getElementById('newsArea');

async function fetchAll(){
  try {
    let res = await fetch('/api/all');
    let data = await res.json();
    let arr = data.signals || [];
    signalsArea.innerHTML = arr.map(s=>`
      <div class="signal-row">
        <div class="signal-title">${s.type || '-'}</div>
        <div class="signal-meta">
          <ul class="signal-param-list">
            <li><b>Таймфрейм:</b> ${s.timeframe||'-'}</li>
            <li><b>Вход:</b> ${s.entry||'-'}</li>
            <li><b>Тейк-профит:</b> ${s.tp||'-'}</li>
            <li><b>Стоп-лосс:</b> ${s.sl||'-'}</li>
          </ul>
        </div>
        <div class="signal-reason"><b>Почему:</b> ${s.reason||'-'}</div>
        <span class="signal-time">${s.time||''}</span>
      </div>
    `).join('');
    let newsArr = data.news || [];
    newsArea.innerHTML = '<ul class="news-list">' + newsArr.map(n=>`
      <li class="news-item">
        <a href="${n.url}" class="news-link" target="_blank">${n.title}</a>
        <span class="news-meta">${n.time}</span>
      </li>
    `).join('') + '</ul>';
  } catch(e){
    signalsArea.innerHTML = "<div style='color:#b22;padding:12px;'>Ошибка загрузки сигналов</div>";
    newsArea.innerHTML = "<div style='color:#b22;padding:12px;'>Ошибка загрузки новостей</div>";
  }
}
fetchAll();
setInterval(fetchAll,60000);
</script>
</body>
</html>
