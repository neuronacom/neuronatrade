<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <title>NEURONA Trade AI</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#fff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-status-bar-style" content="default">
  <link rel="icon" href="https://i.ibb.co/Mk4WpHL9/25-1.png">
  <link rel="apple-touch-icon" href="https://i.ibb.co/XfKRzvcy/27.png">
  <style>
    html,body{height:100%;width:100vw;margin:0;padding:0;overflow:hidden;background:#f6f7fa;}
    body{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-height:100vh;}
    #bg{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:0;pointer-events:none;}
    .top-bar{
      width:100vw;position:fixed;top:0;left:0;z-index:10;display:flex;align-items:center;justify-content:space-between;
      height:52px;background:#fff;box-shadow:0 2px 8px #0001;
      padding:0 13px 0 11px;
    }
    .top-logo{width:30px;margin-right:7px;}
    .top-title{font-weight:bold;font-size:1.22rem;letter-spacing:.09em;color:#222;}
    .notif-bell{
      width:28px;height:28px;margin-left:12px;cursor:pointer;opacity:.92;transition:filter .13s;
      filter: grayscale(0.1) brightness(1.01);
      background:none;border:none;outline:none;display:inline-flex;align-items:center;justify-content:center;
    }
    .notif-bell.active{filter: grayscale(0);}
    @media(max-width:400px){.top-title{font-size:1.02rem;}}
    #main{
      position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;
      margin-top:60px;margin-bottom:10px;width:100%;max-width:385px;min-width:220px;
    }
    .card-block{
      background:#fff;border-radius:18px;box-shadow:0 3px 24px #0001,0 1px 5px #2222;
      padding:0;margin-bottom:15px;display:flex;flex-direction:column;align-items:stretch;
      width:100%;min-height:50px;max-height:360px;overflow:hidden;
    }
    .signals-header, .news-header{
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 20px 6px 20px;
      font-size:1.07rem;font-weight:600;color:#2451b7;
      letter-spacing:.01em;
    }
    .news-header{color:#777;}
    .signals-content, .news-content{
      flex:1;overflow-y:auto;padding:2px 18px 12px 20px;
      font-size:1.05em;line-height:1.57;color:#20232d;
      scrollbar-width:thin;scrollbar-color:#b2b9c5 #ededed;
      background:transparent;
      word-break:break-word;
      font-family:Arial,'Segoe UI',sans-serif;
    }
    .signals-content::-webkit-scrollbar, .news-content::-webkit-scrollbar{
      width:7px;background:#ededed;border-radius:9px;
    }
    .signals-content::-webkit-scrollbar-thumb, .news-content::-webkit-scrollbar-thumb{
      background:#b2b9c5;border-radius:8px;
    }
    .signal-row{
      margin-bottom:16px;background:#eef3fb;border-radius:12px;padding:13px 13px 10px 13px;
      box-shadow:0 2px 8px #2451b726;
      border-left:4px solid #2451b7;
    }
    .signal-title{font-weight:bold;color:#2051ba;font-size:1.14em;letter-spacing:.01em;}
    .signal-params{margin:7px 0 0 0;}
    .signal-param{margin-bottom:3px;}
    .signal-reason{margin-top:8px;color:#444;}
    .signal-time{display:block;color:#888;font-size:0.97em;margin-top:7px;}
    .typing-dots{
      display:inline-flex;gap:2.7px;vertical-align:middle;align-items:flex-end;margin:8px 0 0 6px;
    }
    .tdot{display:inline-block;width:7px;height:7px;background:#bbb;border-radius:50%;opacity:.7;animation:tdotbounce 1.1s infinite;margin-right:2px;}
    .tdot1{animation-delay:0s;}
    .tdot2{animation-delay:.16s;}
    .tdot3{animation-delay:.32s;}
    @keyframes tdotbounce{
      0%,80%,100%{transform:translateY(0);opacity:.66;}
      35%{transform:translateY(-7px);opacity:1;}
      50%{opacity:1;}
    }
    .news-list{list-style:none;padding:0;margin:0;}
    .news-item{margin-bottom:15px;}
    .news-link{color:#2051ba;text-decoration:none;font-weight:500;word-break:break-word;}
    .news-meta{display:block;color:#888;font-size:0.92em;margin-top:2px;}
    .news-impact{color:#b25c3a;font-size:.98em;}
    @media(max-width:480px){
      #main{max-width:98vw;}
      .card-block{max-width:98vw;}
    }
    @media(max-width:400px){
      #main{margin-top:45px;}
    }
    /* DARK THEME */
    body.dark{background:#1b1c1e!important;color:#ececec!important;}
    body.dark .card-block{background:#20232d;color:#fff;}
    body.dark .signals-header{color:#99b5ff;}
    body.dark .news-header{color:#b2b9c5;}
    body.dark .signal-row{background:#23293c;border-left-color:#5167cb;}
    body.dark .signal-title{color:#b8c9ff;}
    body.dark .signal-reason{color:#bbb;}
    body.dark .news-link{color:#b8c9ff;}
    body.dark .news-meta{color:#b2b9c5;}
    body.dark .news-impact{color:#f1b45a;}
    body.dark .top-bar{background:#222;}
    body.dark .top-title{color:#fff;}
  </style>
</head>
<body>
<canvas id="bg"></canvas>
<div class="top-bar">
  <div style="display:flex;align-items:center;">
    <img src="https://i.ibb.co/Mk4WpHL9/25-1.png" class="top-logo" alt="logo">
    <span class="top-title">NEURONA Trade AI</span>
  </div>
  <button class="notif-bell" id="notifBell" title="Включить уведомления">
    <svg viewBox="0 0 28 28" width="23" height="23" fill="none" stroke="#8b8b8b" stroke-width="2"><path d="M14 24a2 2 0 002-2H12a2 2 0 002 2zm6-4V12a6 6 0 10-12 0v8l-2 2v1h16v-1l-2-2z"/></svg>
  </button>
</div>
<div id="main">
  <div class="card-block" style="max-height:260px;">
    <div class="signals-header">AI сигналы</div>
    <div class="signals-content" id="signalsArea">
      <div id="typingSignals" style="display:none;">
        <span class="typing-dots">
          <span class="tdot tdot1"></span>
          <span class="tdot tdot2"></span>
          <span class="tdot tdot3"></span>
        </span>
      </div>
    </div>
  </div>
  <div class="card-block" style="max-height:200px;">
    <div class="news-header">Новости крипторынка</div>
    <div class="news-content" id="newsArea">
      <div id="typingNews" style="display:none;">
        <span class="typing-dots">
          <span class="tdot tdot1"></span>
          <span class="tdot tdot2"></span>
          <span class="tdot tdot3"></span>
        </span>
      </div>
    </div>
  </div>
</div>
<script>
// --- Фон: нейронная сеть ---
const canvas=document.getElementById('bg'),ctx=canvas.getContext('2d');
let W,H,nodes;
function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}
window.addEventListener('resize',resize);
function init(){
  nodes=Array.from({length:33}).map(_=>({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*0.6,vy:(Math.random()-.5)*0.6}));
}
function draw(){
  ctx.clearRect(0,0,W,H);ctx.lineCap='round';ctx.lineJoin='round';
  nodes.forEach((a,i)=>{nodes.slice(i+1).forEach(b=>{
    const dx=a.x-b.x,dy=a.y-b.y,d=Math.hypot(dx,dy);
    if(d<210){
      ctx.strokeStyle=`rgba(60,84,154,${Math.min(0.23,(210-d)/155)})`;
      ctx.lineWidth=1.45;
      ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.stroke();
    }
  });});
  nodes.forEach(n=>{
    n.x+=n.vx;n.y+=n.vy;
    if(n.x<0||n.x>W)n.vx*=-1;
    if(n.y<0||n.y>H)n.vy*=-1;
    ctx.fillStyle='rgba(33,41,79,0.82)';
    ctx.beginPath();ctx.arc(n.x,n.y,3.7,0,2*Math.PI);ctx.fill();
  });
  requestAnimationFrame(draw);
}
resize();init();draw();

// --- Тема (ночь/день) через LocalStorage ---
if(localStorage.getItem('neurona_theme')==='dark')document.body.classList.add('dark');

// --- PUSH уведомления через твой sw.js ---
const notifBell = document.getElementById('notifBell');
notifBell.onclick = async ()=>{
  if(Notification && Notification.permission!=="granted"){
    let perm = await Notification.requestPermission();
    if(perm==="granted"){
      notifBell.classList.add('active');
      alert("Уведомления включены! Теперь вы будете получать пуш по сигналам и новостям.");
    }else{
      alert("Разрешите уведомления в настройках браузера.");
    }
  }else{
    notifBell.classList.add('active');
    alert("Уведомления уже включены! Если не приходят — проверьте настройки браузера/телефона.");
  }
};
if(Notification && Notification.permission==="granted"){
  notifBell.classList.add('active');
}

// --- Сервис-воркер для пушей ---
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('/sw.js');
}

// --- Загрузка AI-сигналов ---
const signalsArea = document.getElementById('signalsArea');
const newsArea = document.getElementById('newsArea');
const typingSignals = document.getElementById('typingSignals');
const typingNews = document.getElementById('typingNews');

// API-запросы: здесь вставь свои эндпоинты!
async function fetchSignals(){
  typingSignals.style.display = 'block';
  signalsArea.scrollTop = signalsArea.scrollHeight;
  try {
    // let res = await fetch('/api/signals');
    // let arr = await res.json();
    // Демо: пример форматирования сигнала!
    let arr = [
      {
        type: 'LONG',
        timeframe: '15м',
        entry: '117650$',
        tp: '118500$',
        sl: '116100$',
        reason: 'Технический отскок от сильной поддержки 117650$. Объёмы растут, позитивные новости по ETF.',
        time: new Date().toLocaleTimeString().slice(0,5)
      },
      {
        type: 'SHORT',
        timeframe: '1ч',
        entry: '118700$',
        tp: '117200$',
        sl: '119550$',
        reason: 'Зона сопротивления. Пробой не подтверждён по объёмам. Рынок перекуплен.',
        time: new Date().toLocaleTimeString().slice(0,5)
      }
    ];
    await new Promise(r=>setTimeout(r,1000));
    signalsArea.innerHTML = arr.map(s=>`
      <div class="signal-row">
        <div class="signal-title">${s.type}</div>
        <div class="signal-params">
          <div class="signal-param"><b>Таймфрейм:</b> ${s.timeframe}</div>
          <div class="signal-param"><b>Вход:</b> ${s.entry}</div>
          <div class="signal-param"><b>Тейк-профит:</b> ${s.tp}</div>
          <div class="signal-param"><b>Стоп-лосс:</b> ${s.sl}</div>
        </div>
        <div class="signal-reason"><b>Почему:</b> ${s.reason}</div>
        <span class="signal-time">${s.time}</span>
      </div>
    `).join('');
  } catch(e){
    signalsArea.innerHTML = "<div style='color:#b22;padding:12px;'>Нет данных по сигналам</div>";
  }
  typingSignals.style.display = 'none';
}

async function fetchNews(){
  typingNews.style.display = 'block';
  newsArea.scrollTop = newsArea.scrollHeight;
  try {
    // let res = await fetch('/api/news');
    // let arr = await res.json();
    let arr = [
      {
        title: 'Bitcoin ETF приток инвестиций достиг $50 млрд — новый рекорд',
        url: 'https://cryptonews.com/news/etf-50b.html',
        source: 'cryptonews',
        time: new Date().toLocaleTimeString().slice(0,5),
        impact: 'BTC'
      },
      {
        title: 'SEC одобрила запуск спотовых ETH ETF',
        url: 'https://news.bitcoin.com/sec-eth-etf-approved',
        source: 'bitcoincom',
        time: new Date().toLocaleTimeString().slice(0,5),
        impact: 'ETH'
      }
    ];
    await new Promise(r=>setTimeout(r,900));
    newsArea.innerHTML = '<ul class="news-list">'+arr.map(n=>`
      <li class="news-item">
        <a href="${n.url}" class="news-link" target="_blank">${n.title}</a>
        <span class="news-meta">${n.source} • ${n.time}${n.impact ? ' <span class="news-impact">['+n.impact+']</span>' : ''}</span>
      </li>
    `).join('')+'</ul>';
  } catch(e){
    newsArea.innerHTML = "<div style='color:#b22;padding:12px;'>Нет новостей</div>";
  }
  typingNews.style.display = 'none';
}

// --- Автоматическое обновление ---
async function reloadAll(){
  fetchSignals();
  fetchNews();
}
reloadAll();
setInterval(reloadAll, 60000); // каждые 60 сек

// --- Если хочешь: добавить тёмную тему/языки — добавь аналогично по паттерну с локалстораджем!
</script>
</body>
</html>
